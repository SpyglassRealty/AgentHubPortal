### Properties Page - Sync Market Pulse Clicks with Listings Filter

**Goal:** When user clicks a Market Pulse bar or stat card, the Spyglass Realty Listings section below should automatically filter to show that status (no page navigation).

---

## Current Behavior
- Click bar â†’ Navigates to `/properties?status=Active` (page reload/navigation)

## Desired Behavior  
- Click bar â†’ Listings section below instantly filters to that status (same page, no navigation)
- Status tabs sync with clicked bar
- Smooth, seamless experience

---

## Implementation

### Update Properties Page Component

The key is to update the `handleStatusClick` function to set the filter state instead of navigating:
```tsx
// In client/src/pages/properties.tsx or the Properties component

import React, { useState, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';

export function PropertiesPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  
  // Status filter state - synced with URL
  const [statusFilter, setStatusFilter] = useState(
    searchParams.get('status') || 'Active'
  );

  // Update URL when filter changes (optional - for shareable links)
  useEffect(() => {
    const params = new URLSearchParams(searchParams);
    params.set('status', statusFilter);
    setSearchParams(params, { replace: true });
  }, [statusFilter]);

  // âœ… CHANGED: Update filter state instead of navigating
  const handleStatusClick = (status: string) => {
    setStatusFilter(status);
    // Scroll to listings section for better UX
    document.getElementById('listings-section')?.scrollIntoView({ 
      behavior: 'smooth',
      block: 'start'
    });
  };

  // ... rest of component
}
```

---

## Full Implementation

### Market Pulse Section (Clickable Bars & Cards)
```tsx
{/* Bar Chart - Clickable Vertical Bars */}
<div className="mb-4">
  <div className="relative h-36 flex items-end justify-around gap-3 px-2">
    {/* Y-axis labels */}
    <div className="absolute left-0 top-0 bottom-0 w-8 flex flex-col justify-between text-[10px] text-gray-400 py-1">
      <span>{maxValue}</span>
      <span>{Math.round(maxValue / 2)}</span>
      <span>0</span>
    </div>
    
    {/* Bars */}
    <div className="flex-1 flex items-end justify-around gap-2 h-full ml-8">
      {statusConfig.map((item) => {
        const heightPercent = maxValue > 0 ? (item.value / maxValue) * 100 : 0;
        const isSelected = statusFilter === item.key;
        
        return (
          <div
            key={item.key}
            className={`flex flex-col items-center flex-1 h-full justify-end cursor-pointer group
              ${isSelected ? 'scale-105' : ''}`}
            onClick={() => handleStatusClick(item.key)}
          >
            {/* Bar */}
            <div
              className={`w-full max-w-16 rounded-t-lg transition-all duration-200 
                group-hover:opacity-75 group-hover:scale-105
                ${isSelected ? 'ring-2 ring-offset-2 ring-[#EF4923]' : ''}`}
              style={{
                height: `${Math.max(heightPercent, 3)}%`,
                backgroundColor: item.color,
                minHeight: '4px'
              }}
            />
            {/* Label */}
            <p className={`text-[10px] mt-2 text-center transition-colors
              ${isSelected ? 'text-[#EF4923] font-semibold' : textSecondary}
              group-hover:text-[#EF4923]`}
            >
              {item.label.replace(' (30d)', '')}
            </p>
          </div>
        );
      })}
    </div>
  </div>
  <p className={`text-xs text-center mt-2 ${textSecondary}`}>
    Click any bar to filter listings
  </p>
</div>

{/* Stat Cards - Clickable */}
<div className="grid grid-cols-2 gap-2 mb-4">
  {statusConfig.map((item) => {
    const Icon = item.icon;
    const isSelected = statusFilter === item.key;
    
    return (
      <div
        key={item.key}
        onClick={() => handleStatusClick(item.key)}
        className={`p-2.5 rounded-lg border cursor-pointer transition-all duration-200
          hover:shadow-md hover:scale-[1.02] active:scale-[0.98]
          ${item.bgColor} ${item.borderColor}
          ${isSelected ? 'ring-2 ring-[#EF4923] shadow-md' : ''}
        `}
      >
        <div className="flex items-center gap-1 mb-0.5">
          <Icon className={`w-3.5 h-3.5 ${item.textColor}`} />
          <span className={`text-xs font-medium ${item.textColor}`}>{item.label}</span>
        </div>
        {item.sublabel && (
          <p className={`text-[10px] ${textSecondary}`}>{item.sublabel}</p>
        )}
        <p className={`text-lg font-bold ${item.textColor} text-right`}>
          {item.value.toLocaleString()}
        </p>
      </div>
    );
  })}
</div>
```

---

### Listings Section (Synced with Filter)
```tsx
{/* ======== LISTINGS SECTION ======== */}
<div id="listings-section">
  {/* Status Tabs - Also synced */}
  <div className="flex items-center gap-2 mb-4 flex-wrap">
    <div className={`flex gap-1 p-1 rounded-lg ${isDark ? 'bg-gray-700' : 'bg-gray-100'}`}>
      {statusTabs.map((tab) => (
        <button
          key={tab.key}
          onClick={() => handleStatusClick(tab.key)}
          className={`px-3 py-1.5 rounded-md text-sm font-medium whitespace-nowrap transition-all
            ${statusFilter === tab.key
              ? 'bg-[#EF4923] text-white'
              : isDark 
                ? 'text-gray-400 hover:text-white hover:bg-gray-600' 
                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-200'
            }
          `}
        >
          {tab.label}
        </button>
      ))}
    </div>
    
    {/* Sort Dropdown */}
    <select
      value={sortBy}
      onChange={(e) => setSortBy(e.target.value)}
      className={`px-3 py-1.5 rounded-lg text-sm border ${borderColor} ${inputBg} ${textPrimary}`}
    >
      <option value="listDate-desc">Newest Listed</option>
      <option value="listDate-asc">Oldest Listed</option>
      <option value="listPrice-desc">Price: High to Low</option>
      <option value="listPrice-asc">Price: Low to High</option>
    </select>
  </div>

  {/* Listings Grid - Filtered by statusFilter */}
  {/* The useQuery should include statusFilter as dependency */}
</div>
```

---

### Update the Listings Query
```tsx
// Listings query - includes statusFilter
const { data: listingsData, isLoading: listingsLoading } = useQuery({
  queryKey: ['spyglass-listings', statusFilter, page, sortBy, sortOrder],
  queryFn: async () => {
    const params = new URLSearchParams({
      status: statusFilter === 'all' ? '' : statusFilter,
      page: page.toString(),
      limit: itemsPerPage.toString(),
      sortBy,
      sortOrder,
    });
    
    const response = await fetch(`/api/company-listings?${params}`);
    if (!response.ok) throw new Error('Failed to fetch');
    return response.json();
  },
});
```

---

## Visual Flow

### User Clicks "Under Contract" Bar:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ Market Pulse                                                    â”‚
â”‚  Spyglass Realty â€¢ Office 5220                                      â”‚
â”‚                                                                     â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆ                                                            â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ â†â”€â”€ CLICKED (now highlighted)                        â”‚
â”‚     â–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ    â–ˆâ–ˆ                                                 â”‚
â”‚    Active Under Pending Closed                                      â”‚
â”‚            ^^^^                                                     â”‚
â”‚            Selected (ring highlight)                                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Active   â”‚  â”‚Under Contractâ”‚  â”‚ Pending  â”‚  â”‚ Closed   â”‚       â”‚
â”‚  â”‚   109    â”‚  â”‚  â˜…â˜… 13 â˜…â˜…   â”‚  â”‚   25     â”‚  â”‚    0     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                 â†‘ Selected (ring highlight)                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ¢ Spyglass Realty Listings                                        â”‚
â”‚  13 under contract listings         â† Updated count                 â”‚
â”‚                                                                     â”‚
â”‚  [Active] [Under Contract âœ“] [Pending] [Closed] [All]              â”‚
â”‚            â†‘ Auto-selected tab                                      â”‚
â”‚                                                                     â”‚
â”‚  Showing 1-13 of 13 results         â† Shows Under Contract only    â”‚
â”‚  [Under Contract listings...]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## Status Config (with matching keys)
```tsx
const statusTabs = [
  { key: 'Active', label: 'Active' },
  { key: 'ActiveUnderContract', label: 'Under Contract' },
  { key: 'Pending', label: 'Pending' },
  { key: 'Closed', label: 'Closed' },
  { key: 'all', label: 'All' },
];

const statusConfig = [
  { 
    key: 'Active',  // Must match statusTabs key
    label: 'Active', 
    sublabel: 'On Market', 
    value: stats.active, 
    color: '#22C55E',
    // ...
  },
  { 
    key: 'ActiveUnderContract',  // Must match statusTabs key
    label: 'Under Contract', 
    sublabel: '', 
    value: stats.activeUnderContract, 
    color: '#3B82F6',
    // ...
  },
  // ... etc
];
```

---

## Testing Checklist

### Click Behavior
- [ ] Clicking Active bar filters listings to Active only
- [ ] Clicking Under Contract bar filters listings to Under Contract only
- [ ] Clicking Pending bar filters listings to Pending only
- [ ] Clicking Closed bar filters listings to Closed only
- [ ] Clicking stat cards also filters listings

### Visual Feedback
- [ ] Selected bar has ring/highlight indicator
- [ ] Selected stat card has ring/highlight indicator
- [ ] Status tab below syncs with selected bar
- [ ] Label under bar shows selected state

### Data Sync
- [ ] "Showing X-Y of Z results" updates correctly
- [ ] Listing count matches stat card number
- [ ] Listings displayed match selected status
- [ ] Page resets to 1 when status changes

### Smooth UX
- [ ] Page scrolls to listings section after click
- [ ] No page reload or navigation
- [ ] URL updates with status parameter (for shareable links)
- [ ] Transition animations are smooth

### Mobile
- [ ] Touch targets 44x44px on bars and cards
- [ ] Scroll to listings works on mobile
- [ ] Status tabs scrollable on small screens

This makes the Market Pulse bars and stat cards act as filters that sync with the listings below, creating a smooth, interactive experience without page navigation. Opus 4.5Claude is AI and can make mistakes. Please double-check responses.ShareProject 